
<div class="wrapper">
  <div id="wheel"></div>
  <button id="clear-button">Tyhjennä</button>
  <ul id="feelings"></ul>
</div>

<style>
  #wheel {
    width: 900px;
    height: 900px;
  }
  path {
    opacity: 0.7;
    cursor: pointer;
  }
  path:hover {
    opacity: 1;
  }
  .wrapper {
    display: flex;
  }
  #clear-button {
    height: 30px;
  }
</style>

<script src="https://d3js.org/d3.v5.min.js"></script>

<script>
const data = {
  children: [

    {
      name: "Nykyisyys",
      children: [
        {
          name: "Itsetuntemus",
          children: [ 
            {
              name: "Tunnetaidot",
              children: [
                 {
                   name: "Empaattisuus", 
                 },
                 {
                   name: "Positiivisuus",
                 },
               ],
             },
            {
              name: "Vahvuudet",
              children: [
                 {
                   name: "Itsetutkiskelu", 
                 },
                 {
                   name: "Resilienssi",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Sosiaalisuus",
          children: [ 
            { 
              name: "Vuorovaikutus",
              children: [
                 {
                   name: "Läsnäolo", 
                 },
                 {
                   name: "Kuuntelevuus",
                 },
               ],
             },
            {
              name: "Ilmaisevuus",
              children: [
                 {
                   name: "Avoimuus", 
                 },
                 {
                   name: "Vastavuoroisuus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Yhteisöllisyys",
          children: [ 
            {
              name: "Vastuullisuus",
              children: [
                 {
                   name: "Rohkeus", 
                 },
                 {
                   name: "Rehellisyys",
                 },
               ],
             },
            {
              name: "Verkostoituvuus",
              children: [
                 {
                   name: "Yhteenkuuluvuus", 
                 },
                 {
                   name: "Tukiverkostot",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Hyvinvointi",
          children: [ 
            {
              name: "Luontosuhde",
              children: [
                 {
                   name: "Vakaus", 
                 },
                 {
                   name: "Vapaus",
                 },
               ],
             },
            {
              name: "Henkisyys",
              children: [
                 {
                   name: "Hengellisyys", 
                 },
                 {
                   name: "Merkityksellisyys",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Terveys",
          children: [ 
            {
              name: "Terveellisyys",
              children: [
                 {
                   name: "Levollisuus", 
                 },
                 {
                   name: "Raittius",
                 },
               ],
             },
            {
              name: "Mielenrauha",
              children: [
                 {
                   name: "Itsemyötätunto", 
                 },
                 {
                   name: "Kiitollisuus",
                 },
               ],
             }, 
          ],
        }, 
        {
          name: "Toimintakyky",
          children: [ 
            {
              name: "Itsenäisyys",
              children: [
                 {
                   name: "Omatoimisuus", 
                 },
                 {
                   name: "Arjenhallinta",
                 },
               ],
             },
            {
              name: "Energisyys",
              children: [
                 {
                   name: "Liikkuvuus", 
                 },
                 {
                   name: "Kestävyys",
                 },
               ],
             }, 
          ],
        },
      ],
    },
    {
      name: "Tulevaisuus",
      children: [
        {
          name: "Tavoitteet",
          children: [ 
            {
              name: "Realistisuus",
              children: [
                 {
                   name: "Sopivuus", 
                 },
                 {
                   name: "Hyödyllisyys",
                 },
               ],
             },
            {
              name: "Saavutettavuus",
              children: [
                 {
                   name: "Havaittavuus", 
                 },
                 {
                   name: "Esteettömyys",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Haaveet",
          children: [ 
            {
              name: "Visio",
              children: [
                 {
                   name: "Usko", 
                 },
                 {
                   name: "Intohimo",
                 },
               ],
             },
            {
              name: "Inspiraatio",
              children: [
                 {
                   name: "Oivallus", 
                 },
                 {
                   name: "Tarkoitus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Mahdollisuudet",
          children: [ 
            {
              name: "Riskinotto",
              children: [
                 {
                   name: "Rohkeus", 
                 },
                 {
                   name: "Itsevarmuus",
                 },
               ],
             },
            {
              name: "Luovuus",
              children: [
                 {
                   name: "Intiuitio", 
                 },
                 {
                   name: "Innovaatio",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Tiedot",
          children: [ 
            {
              name: "Viisaus",
              children: [
                 {
                   name: "Rationaalisuus", 
                 },
                 {
                   name: "Harkitsevuus",
                 },
               ],
             },
            {
              name: "Analyyttisyys",
              children: [
                 {
                   name: "Kriittisyys", 
                 },
                 {
                   name: "Ennakoivuus  ",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Taidot",
          children: [ 
            {
              name: "Ongelmanratkaisu",
              children: [
                 {
                   name: "Uteliaisuus", 
                 },
                 {
                   name: "Oivaltavuus",
                 },
               ],
             },
            {
              name: "Sopeutuvuus",
              children: [
                 {
                   name: "Joustavuus", 
                 },
                 {
                   name: "Itsehillintä",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Kyvyt",
          children: [ 
            {
              name: "Johtavuus",
              children: [
                 {
                   name: "Päätöksenteko", 
                 },
                 {
                   name: "Aloitteellisuus",
                 },
               ],
             },
            {
              name: "Itseohjautuvuus",
              children: [
                 {
                   name: "Sinnikkyys", 
                 },
                 {
                   name: "Omaksuvuus",
                 },
               ],
             }, 
          ],
        },
      ],
    },
    {
      name: "Ajanhallinta",
      children: [
        {
          name: "Tärkeys",
          children: [ 
            {
              name: "Hyöty",
              children: [
                 {
                   name: "Tarpeellisuus", 
                 },
                 {
                   name: "Tuottavuus",
                 },
               ],
             },
            {
              name: "Vaikutus",
              children: [
                 {
                   name: "Tehokkuus", 
                 },
                 {
                   name: "Suorituskyky",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Järjestys",
          children: [ 
            {
              name: "Priorisointi",
              children: [
                 {
                   name: "Valikoivuus", 
                 },
                 {
                   name: "Riskinotto",
                 },
               ],
             },
            {
              name: "Arvostus",
              children: [
                 {
                   name: "Merkitys", 
                 },
                 {
                   name: "Strategisuus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Ajoitus",
          children: [ 
            {
              name: "Soveltuvuus",
              children: [
                 {
                   name: "Ajankohtaisuus", 
                 },
                 {
                   name: "Käytännöllisyys",
                 },
               ],
             },
            {
              name: "Selkeys",
              children: [
                 {
                   name: "Täsmällisyys", 
                 },
                 {
                   name: "Tarkkuus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Työ",
          children: [ 
            {
              name: "Delegointi",
              children: [
                 {
                   name: "Kontrolli", 
                 },
                 {
                   name: "Kehittäminen",
                 },
               ],
             },
            {
              name: "Deadline",
              children: [
                 {
                   name: "Sitoutuvuus", 
                 },
                 {
                   name: "Itsekuri",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Koti",
          children: [ 
            {
              name: "Siisteys",
              children: [
                 {
                   name: "Puhtaus", 
                 },
                 {
                   name: "Hygienisyys",
                 },
               ],
             },
            {
              name: "Rutiinit",
              children: [
                 {
                   name: "Kätevyys", 
                 },
                 {
                   name: "Vaivattomuus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Vapaa-aika",
          children: [ 
            {
              name: "Ulkoilu",
              children: [
                 {
                   name: "Virkistäytyvyys", 
                 },
                 {
                   name: "Liikunnallisuus ",
                 },
               ],
             },
            {
              name: "Tasapainoisuus",
              children: [
                 {
                   name: "Rentouttavuus", 
                 },
                 {
                   name: "Monipuolisuus",
                 },
               ],
             }, 
          ],
        },
      ],
    }, 
    {
      name: "Menneisyys",
      children: [
        {
          name: "Arvostukset",
          children: [ 
            {
              name: "Rauha",
              children: [
                 {
                   name: "Tasa-arvoisuus", 
                 },
                 {
                   name: "Tasavertaisuus",
                 },
               ],
             },
            {
              name: "Oikeudenmukaisuus",
              children: [
                 {
                   name: "Eettisyys", 
                 },
                 {
                   name: "Esteettisyys",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Uskomukset",
          children: [ 
            {
              name: "Maailmankatsomus",
              children: [
                 {
                   name: "Filosofisuus", 
                 },
                 {
                   name: "Tieteellisyys",
                 },
               ],
             },
            {
              name: "Yliluonnollisuus",
              children: [
                 {
                   name: "Uskonnollisuus", 
                 },
                 {
                   name: "Kohtalonomaisuus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Kokemukset",
          children: [ 
            {
              name: "Elämykset",
              children: [
                 {
                   name: "Rakkaus", 
                 },
                 {
                   name: "Saavutukset",
                 },
               ],
             },
            {
              name: "Muistot",
              children: [
                 {
                   name: "Opettajat", 
                 },
                 {
                   name: "Koulukaverit",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Kulttuuri",
          children: [ 
            {
              name: "Aatteellisuus",
              children: [
                 {
                   name: "Ideologisuus", 
                 },
                 {
                   name: "Poliittisuus",
                 },
               ],
             },
            {
              name: "Moraalisuus",
              children: [
                 {
                   name: "Sallivuus", 
                 },
                 {
                   name: "Omatunto",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Suku",
          children: [ 
            {
              name: "Sukulaiset",
              children: [
                 {
                   name: "Isovanhemmat", 
                 },
                 {
                   name: "Serkukset",
                 },
               ],
             },
            {
              name: "Sovinnaisuus",
              children: [
                 {
                   name: "Perinteet", 
                 },
                 {
                   name: "Kunnioitus",
                 },
               ],
             }, 
          ],
        },
        {
          name: "Perhe",
          children: [ 
            {
              name: "Perheenjäsenet",
              children: [
                 {
                   name: "Vanhemmat", 
                 },
                 {
                   name: "Sisarukset",
                 },
               ],
             },
            {
              name: "Perhesiteet",
              children: [
                 {
                   name: "Luottamus", 
                 },
                 {
                   name: "Turvallisuus",
                 },
               ],
             }, 
          ],
        },
      ],
    },
  ],
};

const partition = (data) =>
  d3.partition().size([2 * Math.PI, radius])(d3.hierarchy(data).count());

const color = d3
  .scaleOrdinal()
  .range([
    "#FFE08E",
    "#FF8E8E",
    "#8F8F8F",
    "#8FBCE2",
    "#FFFF8E",
    "#BBA2D0",
    "#8ED9AE",
  ]);

const element = d3.select("#wheel").node();
const width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
const radius = width / 2;

const arc = d3
  .arc()
  .startAngle((d) => d.x0)
  .endAngle((d) => d.x1)
  .padAngle((d) => Math.min((d.x1 - d.x0) / 2, 0.005))
  .padRadius(radius / 2)
  .innerRadius((d) => d.y0)
  .outerRadius((d) => d.y1 - 1);

chart = new (function () {
  const root = partition(data);

  let svg = d3
    .select("#wheel")
    .append("svg")
    .attr("width", width)
    .attr("height", width)
    .style("width", "100%")
    .style("height", "auto")
    .style("font", "0.7rem sans-serif");

  const g = svg
    .append("g")
    .attr("transform", `translate(${width / 2}, ${width / 2})`);

  const paths = g
    .append("g")
    .attr("fill-opacity", 0.6)
    .selectAll("path")
    .data(root.descendants().slice(1))
    .enter()
    .append("path")
    .attr("fill", (d) => {
      while (d.depth > 1) d = d.parent;
      return color(d.data.name);
    })
    .attr("d", arc);

  const text = g
    .append("g")
    .attr("pointer-events", "none")
    .attr("text-anchor", "middle")
    .selectAll("text")
    .data(root.descendants().slice(1))
    .enter()
    .append("text")
    .attr("transform", function (d) {
      const x = (((d.x0 + d.x1) / 2) * 180) / Math.PI;
      const y = (d.y0 + d.y1) / 2;
      return `rotate(${x - 90}) translate(${y},0) rotate(${
        x < 180 ? 0 : 180
      })`;
    })
    .attr("dy", "0.35em")
    .text((d) => d.data.name);

  paths.each(function (d, i) {
    d3.select(this).attr("data-index", i);
  });

  text.each(function (d, i) {
    d3.select(this).attr("data-index", i);
  });

  return svg.node();
})();

(function initialize() {
  const feelings = new Set();
  const colors = {};

  function render() {
    const c = document.querySelector("#feelings");
    c.innerHTML = "";
    for (const feeling of feelings) {
      if (colors[feeling] !== "black") {
        const item = document.createElement("li");
        item.innerText = feeling;
        item.style.color = colors[feeling];
        c.appendChild(item);
      }
    }
  }

  function clear() {
    feelings.clear();
    //colors = {};
    const paths = Array.from(document.querySelectorAll("path"));
    const texts = Array.from(document.querySelectorAll("text"));
    paths.forEach((path) => {
      path.style.fill = null;
    });
    texts.forEach((text) => {
      text.style.fill = null;
    });
    render();
  }

  function clickHandler(e) {
    const index = e.target.getAttribute("data-index");
    const path = document.querySelector(`path[data-index="${index}"]`);
    const text = document.querySelector(`text[data-index="${index}"]`);

    if (path && text) {
      const currentColor = colors[text.textContent] || "black";
      let newColor;

      if (currentColor === "black") {
        newColor = "green";
      } else if (currentColor === "green") {
        newColor = "red";
      } else {
        newColor = "black";
      }

      //path.style.fill = newColor;
      text.style.fill = newColor;

      colors[text.textContent] = newColor;
      feelings.add(text.textContent);
      render();
    }
  }

  const paths = Array.from(document.querySelectorAll("path"));
  paths.forEach((path) => {
    path.addEventListener("click", clickHandler);
  });

  document.querySelector("#clear-button").addEventListener("click", clear);
})();
</script>
